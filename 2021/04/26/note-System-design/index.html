<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>note-System design | linlaw Techblog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script data-ad-client="pub-6040696674298327" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">note-System design</h1><a id="logo" href="/.">linlaw Techblog</a><p class="description">Make the change you want to see in the world.</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> home</i></a><a href="/archives/"><i class="fa fa-archive"> archive</i></a><a href="/about/"><i class="fa fa-user"> about</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">note-System design</h1><div class="post-meta">Apr 26, 2021<span> | </span><span class="category"><a href="/categories/note/">note</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><div class="post-content"><p>CAP:</p>
<ul>
<li><code>Consistency</code>: Assuming you have a storage system which has more than one machine, consistency implies that the data is same across the cluster, so you can read or write to/from any node and get the same data.<ul>
<li>Eventual consistency : Exactly what the name suggests. In a cluster, if multiple machines store the same data, an eventual consistent model implies that all machines will have the same data eventually. Its possible that at a given instance, those machines have different versions of the same data ( temporarily inconsistent ) but they will eventually reach a state where they have the same data.</li>
</ul>
</li>
<li><code>Availability</code>: In the context of a database cluster, Availability refers to the ability to always respond to queries ( read or write ) irrespective of nodes going down.</li>
<li><code>Partition Tolerance</code>: In the context of a database cluster, cluster continues to function even if there is a “partition” (communications break) between two nodes (both nodes are up, but can’t communicate).</li>
</ul>
<p><a href="http://ksat.me/a-plain-english-introduction-to-cap-theorem" target="_blank" rel="noopener">http://ksat.me/a-plain-english-introduction-to-cap-theorem</a></p>
<p>Scaling:</p>
<ul>
<li><code>Vertical scaling</code>:<br>Improving the capabilities of a node/server. Gives greater capacity to the node but does not decrease the overall load on existing members of the cluster. That is, the ability for the improved node to handle existing load is increased, but the load itself is unchanged. Reasons to scale vertically include increasing IOPS, increasing CPU/RAM capacity, and increasing disk capacity.</li>
<li><code>Horizontal Scaling</code><br>Increasing the number of nodes in the cluster. reduces the responsibilities of each member node by spreading the keyspace wider and providing additional endpoints for client connections. That is, the capacity of each individual node does not change, but its load is decreased. Reasons to scale horizontally include increasing I/O concurrency, reducing the load on existing nodes, and increasing disk capacity.</li>
</ul>
<p><code>Sharding</code>: With most huge systems, data does not fit on a single machine. In such cases, sharding refers to splitting the very large database into smaller, faster and more manageable parts called data shards.</p>
<p>Questions:<br>Since we will be storing a massive amount of data, how should we partition our data to distribute it to multiple databases? Should we try to store all the data of a user on the same database? What issue could it cause?<br>How will we handle hot users who tweet a lot or follow lots of people?<br>Since users’ timeline will contain the most recent (and relevant) tweets, should we try to store our data so that it is optimized for scanning the latest tweets?<br>How much and at which layer should we introduce cache to speed things up?<br>What components need better load balancing?<br>Is there any single point of failure in our system? What are we doing to mitigate it?<br>Do we have enough replicas of the data so that we can still serve our users if we lose a few servers?<br>Similarly, do we have enough copies of different services running such that a few failures will not cause a total system shutdown?<br>How are we monitoring the performance of our service? Do we get alerts whenever critical components fail or their performance degrades?</p>
<p>Estimation on Capacity:<br>Our system will be read-heavy. There will be lots of redirection requests compared to new URL shortenings. Let’s assume a 100:1 ratio between read and write.</p>
<p><strong>Traffic estimates</strong>: Assuming, we will have 500M new URL shortenings per month, with 100:1 read/write ratio, we can expect 50B redirections during the same period:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">100 * 500M =&gt; 50B</span><br></pre></td></tr></table></figure>
<p>What would be Queries Per Second (QPS) for our system? New URLs shortenings per second:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">500 million / (30 days * 24 hours * 3600 seconds) = ~200 URLs/s</span><br></pre></td></tr></table></figure></p>
<p>Considering 100:1 read/write ratio, URLs redirections per second will be:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">100 * 200 URLs/s = 20K/s</span><br></pre></td></tr></table></figure>
<p><strong>Storage estimates</strong>: Let’s assume we store every URL shortening request (and associated shortened link) for 5 years. Since we expect to have 500M new URLs every month, the total number of objects we expect to store will be 30 billion:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">500 million * 5 years * 12 months = 30 billion</span><br></pre></td></tr></table></figure></p>
<p>Let’s assume that each stored object will be approximately 500 bytes (just a ballpark estimate–we will dig into it later). We will need 15TB of total storage:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">30 billion * 500 bytes = 15 TB</span><br></pre></td></tr></table></figure></p>
<p><strong>Bandwidth estimates</strong>: For write requests, since we expect 200 new URLs every second, total incoming data for our service will be 100KB per second:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">200 * 500 bytes = 100 KB/s</span><br></pre></td></tr></table></figure></p>
<p>For read requests, since every second we expect ~20K URLs redirections, total outgoing data for our service would be 10MB per second:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">20K * 500 bytes = ~10 MB/s</span><br></pre></td></tr></table></figure></p>
<p><strong>Memory estimates</strong>: If we want to cache some of the hot URLs that are frequently accessed, how much memory will we need to store them? If we follow the 80-20 rule, meaning 20% of URLs generate 80% of traffic, we would like to cache these 20% hot URLs.</p>
<p>Since we have 20K requests per second, we will be getting 1.7 billion requests per day:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">20K * 3600 seconds * 24 hours = ~1.7 billion</span><br></pre></td></tr></table></figure></p>
<p>To cache 20% of these requests, we will need 170GB of memory.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0.2 * 1.7 billion * 500 bytes = ~170GB</span><br></pre></td></tr></table></figure></p>
<p>One thing to note here is that since there will be many duplicate requests (of the same URL), our actual memory usage will be less than 170GB.</p>
<h2 id="Redis-vs-Memchached"><a href="#Redis-vs-Memchached" class="headerlink" title="Redis vs Memchached"></a>Redis vs Memchached</h2><p>Memchached: </p>
<ul>
<li>preferable when caching relatively small and static data</li>
<li>Easy to scale, it’s multi-threaded. While Redis is single-threaded, could horizontally via clustering, but clustering relatively hard to setup.</li>
</ul>
<p>Redis<br><a href="https://www.linkedin.com/pulse/memcached-vs-redis-which-one-pick-ranjeet-vimal/" target="_blank" rel="noopener">https://www.linkedin.com/pulse/memcached-vs-redis-which-one-pick-ranjeet-vimal/</a></p>
<h2 id="General-solution-for-design-quesions"><a href="#General-solution-for-design-quesions" class="headerlink" title="General solution for design quesions:"></a>General solution for design quesions:</h2><p><a href="https://github.com/linlaw0229/system-design-primer/blob/master/README.md#system-design-interview-questions-with-solutions" target="_blank" rel="noopener">https://github.com/linlaw0229/system-design-primer/blob/master/README.md#system-design-interview-questions-with-solutions</a></p>
</div><div class="tags"><a href="/tags/system-design/">system design</a></div><div class="post-nav"><a class="pre" href="/2021/04/27/973-K-Closest-Points-to-Origin/">973. K Closest Points to Origin</a><a class="next" href="/2021/04/24/355-Design-Twitter/">355. Design Twitter</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> categories</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Reading/">Reading</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/STL/">STL</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/algorithm/">algorithm</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/behavioral-question/">behavioral question</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/behavioral-question/amazon/">amazon</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/google/">google</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/leetcode/">leetcode</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/leetcode/amazon/">amazon</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/leetcode/hash-table/">hash table</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/leetcode/hash-table/design/">design</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/leetcode/linked-list/">linked list</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/leetcode/note/">note</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/microsoft/">microsoft</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/note/">note</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming-language/">programming language</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/programming-language/study/">study</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/project/">project</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/study/">study</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/study/programming-language/">programming language</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/tutorial/">tutorial</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> tags</i></div><div class="tagcloud"><a href="/tags/adobe-facebook/" style="font-size: 15px;">adobe facebook</a> <a href="/tags/leetcode/" style="font-size: 15px;">leetcode</a> <a href="/tags/easy/" style="font-size: 15px;">easy</a> <a href="/tags/hard/" style="font-size: 15px;">hard</a> <a href="/tags/string/" style="font-size: 15px;">string</a> <a href="/tags/dynamic-programming/" style="font-size: 15px;">dynamic programming</a> <a href="/tags/backtracking/" style="font-size: 15px;">backtracking</a> <a href="/tags/facebook/" style="font-size: 15px;">facebook</a> <a href="/tags/microsoft/" style="font-size: 15px;">microsoft</a> <a href="/tags/google/" style="font-size: 15px;">google</a> <a href="/tags/apple/" style="font-size: 15px;">apple</a> <a href="/tags/bfs/" style="font-size: 15px;">bfs</a> <a href="/tags/medium/" style="font-size: 15px;">medium</a> <a href="/tags/stack/" style="font-size: 15px;">stack</a> <a href="/tags/amazon/" style="font-size: 15px;">amazon</a> <a href="/tags/dfs/" style="font-size: 15px;">dfs</a> <a href="/tags/array/" style="font-size: 15px;">array</a> <a href="/tags/two-pointers/" style="font-size: 15px;">two pointers</a> <a href="/tags/greedy/" style="font-size: 15px;">greedy</a> <a href="/tags/sliding-window/" style="font-size: 15px;">sliding window</a> <a href="/tags/BFS/" style="font-size: 15px;">BFS</a> <a href="/tags/union-find/" style="font-size: 15px;">union find</a> <a href="/tags/uber/" style="font-size: 15px;">uber</a> <a href="/tags/design/" style="font-size: 15px;">design</a> <a href="/tags/dp/" style="font-size: 15px;">dp</a> <a href="/tags/graph/" style="font-size: 15px;">graph</a> <a href="/tags/hash-table/" style="font-size: 15px;">hash table</a> <a href="/tags/linked-list/" style="font-size: 15px;">linked list</a> <a href="/tags/pure-storage/" style="font-size: 15px;">pure storage</a> <a href="/tags/citrix/" style="font-size: 15px;">citrix</a> <a href="/tags/easy-medium-hard/" style="font-size: 15px;">easy medium hard</a> <a href="/tags/sort/" style="font-size: 15px;">sort</a> <a href="/tags/merge-sort/" style="font-size: 15px;">merge sort</a> <a href="/tags/linkedin/" style="font-size: 15px;">linkedin</a> <a href="/tags/binary-search/" style="font-size: 15px;">binary search</a> <a href="/tags/bloomberg/" style="font-size: 15px;">bloomberg</a> <a href="/tags/two-pointer/" style="font-size: 15px;">two pointer</a> <a href="/tags/yelp/" style="font-size: 15px;">yelp</a> <a href="/tags/heap/" style="font-size: 15px;">heap</a> <a href="/tags/trie/" style="font-size: 15px;">trie</a> <a href="/tags/topological-sort/" style="font-size: 15px;">topological sort</a> <a href="/tags/adobe/" style="font-size: 15px;">adobe</a> <a href="/tags/binary-search-tree/" style="font-size: 15px;">binary search tree</a> <a href="/tags/airbnb/" style="font-size: 15px;">airbnb</a> <a href="/tags/divide-and-conquer/" style="font-size: 15px;">divide and conquer</a> <a href="/tags/lyft/" style="font-size: 15px;">lyft</a> <a href="/tags/math/" style="font-size: 15px;">math</a> <a href="/tags/recursion/" style="font-size: 15px;">recursion</a> <a href="/tags/Floyd-s-Tortoise-and-Hare-Algorithm/" style="font-size: 15px;">Floyd's Tortoise and Hare Algorithm</a> <a href="/tags/epic-system/" style="font-size: 15px;">epic system</a> <a href="/tags/binary-indexed-tree/" style="font-size: 15px;">binary indexed tree</a> <a href="/tags/brainteaser/" style="font-size: 15px;">brainteaser</a> <a href="/tags/permutation/" style="font-size: 15px;">permutation</a> <a href="/tags/bit-manipulation/" style="font-size: 15px;">bit manipulation</a> <a href="/tags/bucket-sort/" style="font-size: 15px;">bucket sort</a> <a href="/tags/has-table/" style="font-size: 15px;">has table</a> <a href="/tags/peak/" style="font-size: 15px;">peak</a> <a href="/tags/random/" style="font-size: 15px;">random</a> <a href="/tags/tree/" style="font-size: 15px;">tree</a> <a href="/tags/oracle/" style="font-size: 15px;">oracle</a> <a href="/tags/greddy/" style="font-size: 15px;">greddy</a> <a href="/tags/String/" style="font-size: 15px;">String</a> <a href="/tags/two-sigma/" style="font-size: 15px;">two sigma</a> <a href="/tags/paypal/" style="font-size: 15px;">paypal</a> <a href="/tags/queue/" style="font-size: 15px;">queue</a> <a href="/tags/partition/" style="font-size: 15px;">partition</a> <a href="/tags/subset/" style="font-size: 15px;">subset</a> <a href="/tags/DFS/" style="font-size: 15px;">DFS</a> <a href="/tags/ebay/" style="font-size: 15px;">ebay</a> <a href="/tags/twitter/" style="font-size: 15px;">twitter</a> <a href="/tags/east/" style="font-size: 15px;">east</a> <a href="/tags/indeed/" style="font-size: 15px;">indeed</a> <a href="/tags/map/" style="font-size: 15px;">map</a> <a href="/tags/snapchat/" style="font-size: 15px;">snapchat</a> <a href="/tags/STL/" style="font-size: 15px;">STL</a> <a href="/tags/C-11/" style="font-size: 15px;">C++ 11</a> <a href="/tags/MSDN/" style="font-size: 15px;">MSDN</a> <a href="/tags/interview/" style="font-size: 15px;">interview</a> <a href="/tags/double-linked-list/" style="font-size: 15px;">double linked list</a> <a href="/tags/BST/" style="font-size: 15px;">BST</a> <a href="/tags/java/" style="font-size: 15px;">java</a> <a href="/tags/spring/" style="font-size: 15px;">spring</a> <a href="/tags/space-complexity/" style="font-size: 15px;">space complexity</a> <a href="/tags/cycle-detection/" style="font-size: 15px;">cycle detection</a> <a href="/tags/algorithm/" style="font-size: 15px;">algorithm</a> <a href="/tags/economics/" style="font-size: 15px;">economics</a> <a href="/tags/Tree/" style="font-size: 15px;">Tree</a> <a href="/tags/tree-traversal/" style="font-size: 15px;">tree traversal</a> <a href="/tags/preorder/" style="font-size: 15px;">preorder</a> <a href="/tags/inorder/" style="font-size: 15px;">inorder</a> <a href="/tags/postorder/" style="font-size: 15px;">postorder</a> <a href="/tags/binary-tree/" style="font-size: 15px;">binary tree</a> <a href="/tags/refer/" style="font-size: 15px;">refer</a> <a href="/tags/job/" style="font-size: 15px;">job</a> <a href="/tags/blockchain/" style="font-size: 15px;">blockchain</a> <a href="/tags/web/" style="font-size: 15px;">web</a> <a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/github/" style="font-size: 15px;">github</a> <a href="/tags/tutorial/" style="font-size: 15px;">tutorial</a> <a href="/tags/note/" style="font-size: 15px;">note</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2021/06/14/1650-Lowest-Common-Ancestor-of-a-Binary-Tree-III/">1650. Lowest Common Ancestor of a Binary Tree III</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/06/13/827-Making-A-Large-Island/">827. Making A Large Island</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/06/13/1762-Buildings-With-an-Ocean-View/">1762. Buildings With an Ocean View</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/06/11/1263-Minimum-Moves-to-Move-a-Box-to-Their-Target-Location/">1263. Minimum Moves to Move a Box to Their Target Location</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/06/09/360-Sort-Transformed-Array/">360. Sort Transformed Array</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/06/09/68-Text-Justification/">68. Text Justification</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/06/08/611-Valid-Triangle-Number/">611. Valid Triangle Number</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/06/08/254-Factor-Combinations/">254. Factor Combinations</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/06/07/366-Find-Leaves-of-Binary-Tree/">366. Find Leaves of Binary Tree</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/06/07/243-Shortest-Word-Distance/">243. Shortest Word Distance</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> blogroll</i></div><ul></ul><a href="https://www.linkedin.com/in/lawrence0229/" title="linlaw's Linkedin" target="_blank">linlaw's Linkedin</a><ul></ul><a href="https://github.com/linlaw0229" title="linlaw's Github" target="_blank">linlaw's Github</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2021 <a href="/." rel="nofollow">linlaw Techblog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></div><!--  a(rel='nofollow', target='_blank', href='https://github.com/tufu9441/maupassant-hexo')  Theme|  by
a(rel='nofollow', target='_blank', href='https://github.com/pagecho')  Cho.--></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>